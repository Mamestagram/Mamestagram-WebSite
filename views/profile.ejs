<!DOCTYPE html>
<html lang="ja">
    <head>
        <title><%= info[0].name %>'s Profile</title>
        <meta name="description" content="osu! private server Mamestagram's profile">
        <%- include("link") %>
        <link rel="stylesheet" href="/css/profile.css">
        <style>
            body::-webkit-scrollbar-track {
                background-color: #fdfdfd;
            }
            body::-webkit-scrollbar-thumb {
                background-color: #2e293d;
            }

            header {
                background-color: transparent;
            }

            .animated {
                background-color: #345c84;
            }

            .animated .pc li:hover {
                background-color: #6495ed;
            }

            @media (max-width: 1232px) {
                header {
                    background-color: #345c84;
                }
            }

            .mobile {
                background-color: #24222a;
            }

            .mobile .leaderboard span {
                border-left: 3px solid #6495ed;
            }

            .mobile li:hover {
                background-color: #4169e1;
            }

            .mobile .register, .mobile .login, .mobile .avatar {
                background-color: #35364d;
                color: #6495ed;
            }
            .mobile .register:hover, .mobile .login:hover, .mobile .avatar:hover {
                background-color: #35364d;
            }

            .link-form a {
                background-color: #345c84;
            }
            .link-form a:hover {
                background-color: #6495ed;
            }
        </style>
        <script type="text/javascript">
            <%
            const getPlayTime = (time) => {
                let rst = "";
                rst += Math.floor(time / 86400).toLocaleString() + "d ";
                time %= 86400;
                rst += Math.floor(time / 3600).toLocaleString() + "h ";
                time %= 3600;
                rst += Math.floor(time / 60).toLocaleString() + "m";
                return rst;
            }
            const getMods = (modNum) => {
                let mod = new Array(0);
                const mods = [
                    "nf", // 0 : NoFail
                    "ez", // 1 : Eazy
                    "ts", // 2 : TouchScreen
                    "hd", // 3 : Hidden
                    "hr", // 4 : HardRock
                    "sd", // 5 : SaddenDeath
                    "dt", // 6 : DoubleTime
                    "rx", // 7 : Relax
                    "ht", // 8 : HalfTime
                    "nc", // 9 : NightCore
                    "fl", // 10 : FlashLight
                    "at", // 11 : AutoPlay
                    "so", // 12 : SpinOut
                    "ap", // 13 : Autopilot
                    "pf", // 14 : Perfect
                    "k4", // 15 : Key4
                    "k5", // 16 : Key5
                    "k6", // 17 : Key6
                    "k7", // 18 : Key7
                    "k8", // 19 : Key9
                    "fi", // 20 : FadeIn
                    "rd", // 21 : Random
                    "cm", // 22 : Cinema
                    "tp", // 23 : TargetPoint
                    "k9", // 24 : Key9
                    "kc", // 25 : KeyCoop
                    "k1", // 26 : Key1
                    "k3", // 27 : Key3
                    "k2", // 28 : Key2
                    "v2", // 29 : ScoreV2
                    "mr"  // 30 : Mirror
                ];
                for (let i = 30; i >= 0; i--) {
                    if (i !== 2 && i !== 11 && !(i >= 15 && i <= 19) && i !== 22 && !(i >= 24 && i <= 28) && modNum >= 1 << i) {
                        switch (i) {
                            case 14:
                                modNum -= 1 << 5;
                                break;
                            case 9:
                                modNum -= 1 << 6;
                                break;
                        }
                        mod.push(mods[i]);
                        modNum -= 1 << i;
                    }
                }
                mod = sortMods(mod);
                return mod;
            }
            const sortMods = (mods) => {
                const order = ["rx", "ap", "nf", "ez", "ht", "hd", "hr", "dt", "nc", "sd", "pf", "fl", "fi", "mr", "so", "v2"];
                let rst = new Array(0);
                for (let i = 0; i < 16; i++) {
                    for (let mod of mods) {
                        if (mod === order[i]) {
                            rst.push(mod);
                            break;
                        }
                    }
                }
                return rst;
            }
            const getMode = (modeNum) => {
                let mode = ""
                switch (modeNum) {
                    case 0:
                        mode += "osu";
                        break;
                    case 1:
                        mode += "taiko";
                        break;
                    case 2:
                        mode += "fruits";
                        break;
                    case 3:
                        mode += "mania";
                        break;
                }
                return mode;
            }
            const getSongName = (name, diff, artist, format) => {
                if (format === "simple") {
                    return name + " by " + artist;
                }
                else if (format === "full") {
                    return name + " [" + diff + "] by " + artist;
                }
            }
            const bestppRecCount = (page, data) => {
                let i = 0, num = 0, display = false, flag, cnt = 0;
                for (let map of data) {
                    if (num >= page * 10 - 10) {
                        display = true;
                    }
                    if (num >= page * 10 || num >= 100) {
                        break;
                    }
                    flag = true;
                    for(let j = 0; j < i; j++) {
                        if (data[j].md5 === map.md5) {
                            flag = false;
                            break;
                        }
                    }
                    if (display && flag) {
                        cnt++;
                        num++;
                    }
                    else if (flag) {
                        num++;
                    }
                    i++;
                }
                return cnt;
            }
            const playsRecCount = (page, data, amount) => {
                let num = 0, display = false, cnt = 0;
                for (let map of data) {
                    if (num >= page * amount - amount) {
                        display = true;
                    }
                    if (num >= page * amount) {
                        break;
                    }
                    if (display) {
                        cnt++;
                    }
                    num++;
                }
                return cnt;
            }
            %>
        </script>
    </head>
    <body>
        <%- include("header") %>
        <main>
            <div class="box player-banner">
                <div class="username">
                    <img src="https://a.mamesosu.net/<%= locals.userid %>?<%= Math.floor(Math.random() * 1000) %>" alt="">
                    <h1><%= info[0].name %></h1>
                    <i class="flag-icon flag-icon-<%= info[0].country %>"></i>
                </div>
                <div class="selection">
                    <ul class="special">
                        <li class="classic">
                            <button>Classic</button>
                        </li>
                        <li class="relax">
                            <button>Relax</button>
                        </li>
                        <li class="auto-pilot">
                            <button>Auto Pilot</button>
                        </li>
                    </ul>
                    <ul class="mode">
                        <li class="std">
                            <button><i class="mode-icon mode-osu"></i></button>
                        </li>
                        <li class="taiko">
                            <button><i class="mode-icon mode-taiko"></i></button>
                        </li>
                        <li class="catch">
                            <button><i class="mode-icon mode-fruits"></i></button>
                        </li>
                        <li class="mania">
                            <button><i class="mode-icon mode-mania"></i></button>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="box player-info">
                <div class="overview">
                    <div class="wrap ranking">
                        <div class="global">
                            <h1>Global Ranking</h1>
                            <h2>
                                <% if (info[0].acc === 0 || info[0].priv === 2) { %>
                                    -
                                <% } else { %>
                                    #<%= info[0].Granking %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="country">
                            <h1>Country Ranking</h1>
                            <h2>
                                <% if (info[0].acc === 0 || info[0].priv === 2) { %>
                                    -
                                <% } else { %>
                                    #<%= info[0].Cranking %>
                                <% } %>
                            </h2>
                        </div>
                    </div>
                    <div class="wrap detail">
                        <div class="medals">
                            <h1>Medals</h1>
                            <h2><%= info[0].medals %></h2>
                        </div>
                        <div class="pp">
                            <h1>pp</h1>
                            <h2><%= info[0].pp %></h2>
                        </div>
                        <div class="playtime">
                            <h1>Total Play Time</h1>
                            <h2><%= getPlayTime(info[0].playtime) %></h2>
                        </div>
                    </div>
                    <div class="wrap grade-amounts">
                        <div class="xh">
                            <img src="/image/grade/XH.png" alt=""><br>
                            <%= info[0].xh_count %>
                        </div>
                        <div class="x">
                            <img src="/image/grade/X.png" alt=""><br>
                            <%= info[0].x_count %>
                        </div>
                        <div class="sh">
                            <img src="/image/grade/SH.png" alt=""><br>
                            <%= info[0].sh_count %>
                        </div>
                        <div class="s">
                            <img src="/image/grade/S.png" alt=""><br>
                            <%= info[0].s_count %>
                        </div>
                        <div class="a">
                            <img src="/image/grade/A.png" alt=""><br>
                            <%= info[0].a_count %>
                        </div>
                    </div>
                </div>
                <span class="border"></span>
                <div class="stats">
                    <div class="acc">
                        <h1>Hit Accuracy</h1>
                        <h2><%= info[0].acc.toFixed(2) %></h2>
                    </div>
                    <div class="plaucount">
                        <h1>Play Count</h1>
                        <h2><%= info[0].plays.toLocaleString() %></h2>
                    </div>
                    <div class="hits">
                        <h1>Total hits</h1>
                        <h2><%= info[0].total_hits.toLocaleString() %></h2>
                    </div>
                    <div class="rankedscore">
                        <h1>Ranked Score</h1>
                        <h2><%= info[0].rscore.toLocaleString() %></h2>
                    </div>
                    <div class="totalscore">
                        <h1>Total Score</h1>
                        <h2><%= info[0].tscore.toLocaleString() %></h2>
                    </div>
                    <div class="maxcombo">
                        <h1>Maximum Combo</h1>
                        <h2><%= info[0].max_combo.toLocaleString() %></h2>
                    </div>
                    <div class="watched">
                        <h1>Replays Watched</h1>
                        <h2><%= info[0].replay_views.toLocaleString() %></h2>
                    </div>
                </div>
            </div>
            <div class="box bestpp">
                <h1>Best Performance</h1>
                <% let n = 0; %>
                <% bestpp.forEach((data) => { %>
                    <div class="mode-<%= n++ %>">
                        <% if (data.length <= 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% let flag, amt = 0; %>
                            <% for (let i = 0; i < data.length; i++) { %>
                                <%
                                let arr = new Array(0);
                                for (let j = 0; j < i; j++) { arr.push(data[j].id); }
                                flag = !(getMods(data[i].mods).includes("so") || arr.includes(data[i].id));
                                %>
                                <% if (flag && amt < 100) { %>
                                    <div class="wrap data">
                                        <img class="grade" src="/image/grade/<%= data[i].grade %>.png" alt="">
                                        <a href="/beatmap/<%= data[i].set_id%>/<%= data[i].id %>/<%= data[i].version %>">
                                            <p class="title"><%= data[i].title %> by <%= data[i].artist %></p>
                                            <p class="diff"><%= data[i].version %></p>
                                        </a>
                                        <div class="mods">
                                            <% getMods(data[i].mods).forEach((mod) => { %>
                                                <img class="img" src="/image/mods/<%= mod %>.png" alt="">
                                            <% }); %>
                                        </div>
                                        <p class="acc"><%= data[i].acc.toFixed(2) %>%</p>
                                        <div class="pp">
                                            <p class="recorded"><%= Math.round(data[i].pp).toLocaleString() %><span>pp</span></p>
                                            <p class="weighted">(<%= Math.round(data[i].pp * Math.pow(0.95, amt++)).toLocaleString() %>pp)</p>
                                        </div>
                                    </div>
                                <% } %>
                            <% } %>
                        <% } %>
                    </div>
                <% }); %>
            </div>
            <div class="box mostplays">
                <h1>Most Plays</h1>
                <% n = 0; %>
                <% mostplays.forEach((data) => { %>
                    <div class="mode-<%= n++ %>">
                        <% if (data.length <= 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% for (let i = 0; i < data.length; i++) { %>
                                <div class="data">
                                    <img src="https://b.ppy.sh/thumb/<%= data[i].set_id %>l.jpg?" alt="">
                                    <a href="/beatmap/<%= data[i].set_id %>/<%= data[i].id %>/<%= data[i].version %>">
                                        <p class="title"><%= data[i].title %> [<%= data[i].version%>] by <%= data[i].artist %></p>
                                        <p class="mapper">mapped by <span><%= data[i].creator %></span></p>
                                    </a>
                                    <i class="mode-icon mode-<%= getMode(data[i].mode) %>"></i>
                                    <i class="fa-solid fa-play fa-xs play-icon"></i>
                                    <p class="value"><%= data[i].playtimes.toLocaleString() %></p>
                                </div>
                            <% } %>
                        <% } %>
                    </div>
                <% }); %>
            </div>
            <div class="box recentplays">
                <h1>Recent Plays</h1>
                <% n = 0; %>
                <% recentplays.forEach((data) => { %>
                    <div class="mode-<%= n++ %>">
                        <% if (data.length <= 0) { %>
                            <h1 class="nothing">No scores available</h1>
                        <% } else { %>
                            <% for (let i = 0; i < data.length; i++) { %>
                                <div class="data">
                                    <img class="grade" src="/image/grade/<%= data[i].grade %>.png" alt="">
                                    <a href="/beatmap/<%= data[i].set_id %>/<%= data[i].id %>/<%= data[i].version %>">
                                        <p class="title"><%= data[i].title %> by <%= data[i].artist %></p>
                                        <p class="diff"><%= data[i].version %></p>
                                    </a>
                                    <div class="mods">
                                        <% getMods(data[i].mods).forEach((mod) => { %>
                                            <img class="mod" src="/image/mods/<%= mod %>.png" alt="">
                                        <% }); %>
                                    </div>
                                    <p class="acc"><%= data[i].acc.toFixed(2) %></p>
                                    <div class="pp">
                                        <p class="recorded"><%= Math.round(data[i].pp).toLocaleString() %><span>pp</span></p>
                                        <% if (data[i].status !== 2) { %>
                                            <p class="loved">(Loved)</p>
                                        <% } %>
                                    </div>
                                </div>
                            <% } %>
                        <% } %>
                    </div>
                <% }); %>
            </div>
        </main>
        <%- include("footer") %>
    </body>
</html>