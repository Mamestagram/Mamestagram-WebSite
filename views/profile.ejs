<!DOCTYPE html>
<html lang="ja">
    <head>
        <title><%= info.name %>'s Profile | Mamestagram</title>
        <meta name="robots" content="noindex">
        <%- include("link") %>
        <link rel="stylesheet" href="/css/profile.css">
        <script src="/jquery/profile.js"></script>
        <style>
            body::-webkit-scrollbar-track {
                background-color: #fdfdfd;
            }
            body::-webkit-scrollbar-thumb {
                background-color: #2e293d;
            }

            header {
                background-color: transparent;
            }

            .animated {
                background-color: #345c84;
            }

            .animated .pc li:hover {
                background-color: #6495ed;
            }

            @media (max-width: 1232px) {
                header {
                    background-color: #345c84;
                }
            }

            .mobile {
                background-color: #24222a;
            }

            .mobile li:hover {
                background-color: #4169e1;
            }

            .mobile .register, .mobile .login, .mobile .avatar {
                background-color: #35364d;
                color: #6495ed;
            }
            .mobile .register:hover, .mobile .login:hover, .mobile .avatar:hover {
                background-color: #35364d;
            }

            .link-form a, .link-form button {
                background-color: #345c84;
            }
            .link-form a:hover, .link-form button:hover {
                background-color: #6495ed;
            }

            .search-form .searchbox {
                background-color: #2c2c2c;
            }

            .search-form .searchbox .txtbox {
                border-bottom: 2px solid #757575;
            }
        </style>
        <%
        const getPlayTime = (time) => {
            let rst = "";
            rst += Math.floor(time / 86400).toLocaleString() + "d ";
            time %= 86400;
            rst += Math.floor(time / 3600).toLocaleString() + "h ";
            time %= 3600;
            rst += Math.floor(time / 60).toLocaleString() + "m";
            return rst;
        }
        const getMods = (modNum) => {
            let mod = new Array(0);
            const mods = [
                "nf", // 0 : NoFail
                "ez", // 1 : Eazy
                "ts", // 2 : TouchScreen
                "hd", // 3 : Hidden
                "hr", // 4 : HardRock
                "sd", // 5 : SaddenDeath
                "dt", // 6 : DoubleTime
                "rx", // 7 : Relax
                "ht", // 8 : HalfTime
                "nc", // 9 : NightCore
                "fl", // 10 : FlashLight
                "at", // 11 : AutoPlay
                "so", // 12 : SpinOut
                "ap", // 13 : Autopilot
                "pf", // 14 : Perfect
                "k4", // 15 : Key4
                "k5", // 16 : Key5
                "k6", // 17 : Key6
                "k7", // 18 : Key7
                "k8", // 19 : Key8
                "fi", // 20 : FadeIn
                "rd", // 21 : Random
                "cm", // 22 : Cinema
                "tp", // 23 : TargetPoint
                "k9", // 24 : Key9
                "kc", // 25 : KeyCoop
                "k1", // 26 : Key1
                "k3", // 27 : Key3
                "k2", // 28 : Key2
                "v2", // 29 : ScoreV2
                "mr"  // 30 : Mirror
            ];
            for (let i = 30; i >= 0; i--) {
                if (i !== 2 && i !== 11 && i !== 19 && i !== 22 && !(i >= 24 && i <= 28) && modNum >= 1 << i) {
                    switch (i) {
                        case 14:
                            modNum -= 1 << 5;
                            break;
                        case 9:
                            modNum -= 1 << 6;
                            break;
                    }
                    mod.push(mods[i]);
                    modNum -= 1 << i;
                }
            }
            mod = sortMods(mod);
            return mod;
        }
        const sortMods = (mods) => {
            const order = ["rx", "ap", "k4", "k5", "k6", "k7", "nf", "ez", "ht", "hd", "hr", "dt", "nc", "sd", "pf", "fl", "fi", "rd", "mr", "so", "v2"];
            let rst = new Array(0);
            for (let i = 0; i < order.length; i++) {
                for (let mod of mods) {
                    if (mod === order[i]) {
                        rst.push(mod);
                        break;
                    }
                }
            }
            return rst;
        }
        const getMode = (modeNum) => {
            switch (modeNum) {
                case 0: return "osu";
                case 1: return "taiko";
                case 2: return "fruits";
                case 3: return "mania";
            }
        }
        %>
    </head>
    <body>
        <img class="background-img" src="https://bg.mamesosu.net/<%= id %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" loading="lazy" width="100%" height="100%" />
        <%- include("header") %> 
        <main>
            <div class="box banner-box">
                <img src="https://banner.mamesosu.net/<%= id %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" loading="lazy" width="100%" height="250" />
            </div>
            <div class="box player-banner">
                <div class="username">
                    <img class="avatar" src="https://a.mamesosu.net/<%= id %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" alt="" />
                    <!--
                    <% if (info.verified) { %>
                        <img class="badge verified" src="/image/badge/verified.png" alt="" title="verified✓">
                        <img class="badge verified-hover" src="/image/badge/verified-hover.png" alt="" title="verified✓">
                    <% } %>
                    -->
                    <div>
                        <h1><%= info.name %></h1>
                        <% if (id === locals.userid) { %>
                            <a href="/edit" class="edit">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </a>
                        <% } %>
                        <i class="flag-icon flag-icon-<%= info.country %>"></i>
                        <div class="flex-box">
                            <% if (info.show_pName === 1 && info.past_name !== null) { %>
                                <p class="aka">aka: <%= info.past_name %></p>
                            <% } %>
                            <% if (beFollowed) { %>
                                <p class="be-followed">Follows you</p>
                            <% } %>
                        </div>
                    </div>
                    <% if (loginf && id !== locals.userid) { %>
                        <span id="follow">
                            <span class="follow-btn" onclick="clickFollowButton()"
                            <% if (followStatus === "following") { %>
                                style="background-color: #7ea015;"
                            <% } else if (followStatus === "mutual") { %>
                                style="background-color: #c4598c;"
                            <% } else { %>
                                style="background-color: #17171c;"
                            <% } %>>
                                <% if (followStatus !== "none") { %>
                                    <i class="fa-solid fa-user-xmark"></i>
                                    <p class="tooltip">Unfollow</p>
                                <% } else { %>
                                    <i class="fa-solid fa-user-plus"></i>
                                    <p class="tooltip">Follow</p>
                                <% } %>
                            </span>
                        </span>
                    <% } %>
                </div>
                <div id="relationships" class="relationship">
                    <span id="mutual" class="mutual">
                        <i class="fa-solid fa-handshake-simple"></i>
                        <%= mutual %>
                        <p class="tooltip">Mutual</p>
                    </span>
                    <span id="following" class="following">
                        <i class="fa-solid fa-user"></i>
                        <%= following %>
                        <p class="tooltip">Following</p>
                    </span>
                    <span id="followers" class="followers">
                        <i class="fa-solid fa-users"></i>
                        <%= followers %>
                        <p class="tooltip">Followers</p>
                    </span>
                    <% if (mutualList.length > 0) { %>
                        <div class="list mutual-list">
                            <div class="wrap">
                                <h1><i class="fa-solid fa-handshake-simple"></i>Mutual<i class="fa-solid fa-xmark"></i></h1>
                                <% mutualList.forEach((data) => { %>
                                    <a class="data" href="/profile/<%= data.user2 %>/std">
                                        <img class="avatar" src="https://a.mamesosu.net/<%= data.user2 %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" alt="">
                                        <div class="name">
                                            <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                            <p class="username"><%= data.name %></p>
                                        </div>
                                    </a>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    <% if (followingList.length > 0) { %>
                        <div class="list following-list">
                            <div class="wrap">
                                <h1><i class="fa-solid fa-user"></i>Following<i class="fa-solid fa-xmark"></i></h1>
                                <% followingList.forEach((data) => { %>
                                    <a class="data" href="/profile/<%= data.user2 %>/std">
                                        <img class="avatar" src="https://a.mamesosu.net/<%= data.user2 %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" alt="">
                                        <div class="name">
                                            <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                            <p class="username"><%= data.name %></p>
                                        </div>
                                    </a>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    <% if (followersList.length > 0) { %>
                        <div class="list followers-list">
                            <div class="wrap">
                                <h1><i class="fa-solid fa-users"></i>Followers<i class="fa-solid fa-xmark"></i></h1>
                                <% followersList.forEach((data) => { %>
                                    <a class="data" href="/profile/<%= data.user1 %>/std">
                                        <img class="avatar" src="https://a.mamesosu.net/<%= data.user1 %>?<%= Math.floor(Math.random() * 10000000000 + 1) %>" alt="">
                                        <div class="name">
                                            <i title="<%= data.country %>" class="flag-icon flag-icon-<%= data.country %>"></i>
                                            <p class="username"><%= data.name %></p>
                                        </div>
                                    </a>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                    <div class="player-status">
                        <span
                        <% if (online) { %>
                            style="background-color: #b3d944;"
                        <% } else { %>
                            style="background-color: #000;"
                        <% } %>></span>
                        <p>
                            <% if (online) { %>
                                Online
                            <% } else { %>
                                Offline
                            <% } %>
                        </p>
                    </div>
                </div>
                <div class="selection">
                    <ul class="special">
                        <li class="classic"
                        <% if (modeNum >= 0 && modeNum < 4 && !dans) { %>
                            style="border-bottom: 2px solid #fdfdfd; filter: invert(0%); opacity: 1;"
                        <% } %>>
                            <a
                            <% if (modeNum % 4 === 0) { %>
                                href="/profile/<%= id %>/std"
                            <% } else if (modeNum % 4 === 1) { %>
                                href="/profile/<%= id %>/taiko"
                            <% } else if (modeNum % 4 === 2) { %>
                                href="/profile/<%= id %>/ctb"
                            <% } else { %>
                                href="/profile/<%= id %>/mania"
                            <% } %>>Classic</a>
                        </li>
                        <% if (modeNum !== 3) { %>
                            <li class="relax"
                            <% if (modeNum >= 4 && modeNum < 7 && !dans) { %>
                                style="border-bottom: 2px solid #fdfdfd; filter: invert(0%); opacity: 1;"
                            <% } %>>
                                <a
                                <% if (modeNum % 4 === 0) { %>
                                    href="/profile/<%= id %>/stdrx"
                                <% } else if (modeNum % 4 === 1) { %>
                                    href="/profile/<%= id %>/taikorx"
                                <% } else if (modeNum % 4 === 2) { %>
                                    href="/profile/<%= id %>/ctbrx"
                                <% } %>>Relax</a>
                            </li>
                        <% } %>
                        <% if (modeNum % 4 === 0) { %>
                            <li class="auto-pilot"
                            <% if (modeNum === 8 && !dans) { %>
                                style="border-bottom: 2px solid #fdfdfd; filter: invert(0%); opacity: 1;"
                            <% } %>>
                                <a href="/profile/<%= id %>/stdap">Auto Pilot</a>
                            </li>
                        <% } %>
                        <li class="dans"
                        <% if (dans) { %>
                            style="border-bottom: 2px solid #fdfdfd; filter: invert(0%); opacity: 1;"
                        <% } %>>
                            <a
                            <% if (modeNum % 4 === 0) { %>
                                href="/profile/<%= id %>/std&dans"
                            <% } else if (modeNum % 4 === 1) { %>
                                href="/profile/<%= id %>/taiko&dans"
                            <% } else if (modeNum % 4 === 2) { %>
                                href="/profile/<%= id %>/ctb&dans"
                            <% } else if (modeNum === 3) { %>
                                href="/profile/<%= id %>/mania&dans"
                            <% } %>>Dans</a>
                        </li>
                    </ul>
                    <ul class="mode">
                        <li class="std"
                        <% if (modeNum % 4 === 0) { %>
                            style="filter: invert(0%); opacity: 1"
                        <% } %>>
                            <a
                            <% if (dans) { %>
                                href="/profile/<%= id %>/std&dans"
                            <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                href="/profile/<%= id %>/std"
                            <% } else if (modeNum < 7) { %>
                                href="/profile/<%= id %>/stdrx"
                            <% } else { %>
                                href="/profile/<%= id %>/stdap"
                            <% } %>><i class="mode-icon mode-osu"></i></a>
                        </li>
                        <% if (modeNum !== 8) { %>
                            <li class="taiko"
                            <% if (modeNum % 4 === 1) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %>/taiko&dans"
                                <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                    href="/profile/<%= id %>/taiko"
                                <% } else { %>
                                    href="/profile/<%= id %>/taikorx"
                                <% } %>><i class="mode-icon mode-taiko"></i></a>
                            </li>
                            <li class="catch"
                            <% if (modeNum % 4 === 2) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %>/ctb&dans"
                                <% } else if (modeNum >= 0 && modeNum < 4) { %>
                                    href="/profile/<%= id %>/ctb"
                                <% } else { %>
                                    href="/profile/<%= id %>/ctbrx"
                                <% } %>><i class="mode-icon mode-fruits"></i></a>
                            </li>
                        <% } %>
                        <% if (modeNum >= 0 && modeNum < 4) { %>
                            <li class="mania"
                            <% if (modeNum === 3) { %>
                                style="filter: invert(0%); opacity: 1"
                            <% } %>>
                                <a
                                <% if (dans) { %>
                                    href="/profile/<%= id %>/mania&dans"
                                <% } else { %>
                                    href="/profile/<%= id %>/mania"
                                <% } %>>
                                    <i class="mode-icon mode-mania"></i>
                                </a>
                            </li>
                        <% } %>
                    </ul>
                </div>
                <div class="me">
                    <h1><i class="fa-solid fa-id-badge"></i>me!</h1>
                    <p class="edit-button" style="display: none;">
                        <i class="fa-solid fa-pen"></i>
                    </p>
                    <div class="contents">
                        <div id="put-bbcode" class="bbcode-profile" style="display: none;">
                            <% if (bbcode === null) { %>
                                <div class="me-empty">
                                    <% if (id === locals.userid) { %>
                                        <p class="edit-me">Edit me!</p>
                                        <i class="fa-solid fa-user-pen"></i>
                                        <p class="description">Express yourself by editing <strong>me!</strong></p>
                                    <% } else { %>
                                        <p class="nothing">No contents</p>
                                    <% } %>
                                </div>
                            <% } %>
                            <%= me %>
                        </div>
                        <form action="/me" method="post" style="display: none;">
                            <textarea id="me-editor" placeholder="Type page content here" name="content"><%= bbcode %></textarea>
                            <div class="editor">
                                <div class="bb-button">
                                    <p title="Heading" class="heading">
                                        <i class="fa-solid fa-heading"></i>
                                    </p>
                                    <p title="Bold" class="bold">
                                        <i class="fa-solid fa-bold"></i>
                                    </p>
                                    <p title="Italic" class="italic">
                                        <i class="fa-solid fa-italic"></i>
                                    </p>
                                    <p title="Underline" class="underline">
                                        <i class="fa-solid fa-underline"></i>
                                    </p>
                                    <p title="Strikethrough" class="strike">
                                        <i class="fa-solid fa-strikethrough"></i>
                                    </p>
                                    <p title="Color text" class="color">
                                        <i class="fa-solid fa-droplet"></i>
                                    </p>
                                    <p title="Spoiler" class="spoiler-text">
                                        <i class="fa-solid fa-rectangle-xmark"></i>
                                    </p>
                                    <p title="Center" class="center">
                                        <i class="fa-solid fa-align-center"></i>
                                    </p>
                                    <p title="Spoilerbox" class="spoilerbox">
                                        <i class="fa-solid fa-square-caret-down"></i>
                                    </p>
                                    <p title="List" class="list">
                                        <i class="fa-solid fa-list-ul"></i>
                                    </p>
                                    <p title="Numbered list" class="num-list">
                                        <i class="fa-solid fa-list-ol"></i>
                                    </p>
                                    <p title="Quote" class="quote">
                                        <i class="fa-solid fa-arrows-rotate"></i>
                                    </p>
                                    <p title="Image" class="image">
                                        <i class="fa-solid fa-image"></i>
                                    </p>
                                    <p title="Link" class="url">
                                        <i class="fa-solid fa-link"></i>
                                    </p>
                                    <p title="Profile" class="profile">
                                        <i class="fa-solid fa-address-card"></i>
                                    </p>
                                    <p title="Code block" class="code">
                                        <i class="fa-solid fa-code"></i>
                                    </p>
                                    <select title="Font size" class="size">
                                        <option value="title" hidden selected>Font size</option>
                                        <option value="tiny">Tiny</option>
                                        <option value="small">Small</option>
                                        <option value="normal">Normal</option>
                                        <option value="large">Large</option>
                                    </select>
                                    <a href="https://github.com/Mamestagram/BBCode-Usage" target="_blank" rel="noopener noreferrer">Help</a>
                                </div>
                                <div class="edit">
                                    <p class="cancel" onclick="cancel()">Cancel</p>
                                    <p class="preview" onclick="showPreview()">Preview</p>
                                    <p class="back-to-edit" onclick="backToEditor()" style="display: none">Edit</p>
                                    <p class="save" onclick="save()">Save</p>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="box player-info">
                <div class="overview">
                    <div class="wrap ranking">
                        <div class="global">
                            <h1>Global Ranking</h1>
                            <h2>
                                <% if (info.acc === 0 || (info.priv !== 3 && info.priv !== 7 && info.priv !== 4099 && info.priv !== 6147 && info.priv !== 31879)) { %>
                                    -
                                <% } else { %>
                                    #<%= ranking.global[0].value.toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="country">
                            <h1>Country Ranking</h1>
                            <h2>
                                <% if (info.acc === 0 || (info.priv !== 3 && info.priv !== 7 && info.priv !== 4099 && info.priv !== 6147 && info.priv !== 31879)) { %>
                                    -
                                <% } else { %>
                                    #<%= ranking.country[0].value.toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                    </div>
                    <div class="wrap detail">
                        <div class="medals"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Medals</h1>
                            <h2><%= medals.toLocaleString() %></h2>
                        </div>
                        <div class="pp">
                            <h1>pp</h1>
                            <h2>
                                <% if (dans) { %>
                                    <%= pp.toLocaleString() %>
                                <% } else { %>
                                    <%= info.pp.toLocaleString() %>
                                <% } %>
                            </h2>
                        </div>
                        <div class="playtime"
                        <% if (dans) { %>
                            style="filter: invert(50%); opacity: 0.95;"
                        <% } %>>
                            <h1>Total Play Time</h1>
                            <h2><%= getPlayTime(info.playtime) %></h2>
                        </div>
                    </div>
                    <div class="wrap grade-amounts">
                        <div class="xh">
                            <img src="/image/grade/XH.png" alt=""><br>
                            <%= grade.xh[0].value.toLocaleString() %>
                        </div>
                        <div class="x">
                            <img src="/image/grade/X.png" alt=""><br>
                            <%= grade.x[0].value.toLocaleString() %>
                        </div>
                        <div class="sh">
                            <img src="/image/grade/SH.png" alt=""><br>
                            <%= grade.sh[0].value.toLocaleString() %>
                        </div>
                        <div class="s">
                            <img src="/image/grade/S.png" alt=""><br>
                            <%= grade.s[0].value.toLocaleString() %>
                        </div>
                        <div class="a">
                            <img src="/image/grade/A.png" alt=""><br>
                            <%= grade.a[0].value.toLocaleString() %>
                        </div>
                    </div>
                </div>
                <div class="stats">
                    <div class="acc">
                        <h1>Hit Accuracy</h1>
                        <h2>
                            <% if (dans) { %>
                                <%= acc.toFixed(2) %>
                            <% } else { %>
                                <%= info.acc.toFixed(2) %>
                            <% } %>
                            %
                        </h2>
                    </div>
                    <div class="playcount">
                        <h1>Play Count</h1>
                        <h2>
                            <% if (dans) { %>
                                <%= plays.toLocaleString() %>
                            <% } else { %>
                                <%= info.plays.toLocaleString() %>
                            <% } %>
                        </h2>
                    </div>
                    <div class="hits"
                    <% if (dans) { %>
                        style="filter: invert(50%); opacity: 0.95;"
                    <% } %>>
                        <h1>Total hits</h1>
                        <h2><%= info.total_hits.toLocaleString() %></h2>
                    </div>
                    <div class="rankedscore"
                    <% if (dans) { %>
                        style="filter: invert(50%); opacity: 0.95;"
                    <% } %>>
                        <h1>Ranked Score</h1>
                        <h2><%= info.rscore.toLocaleString() %></h2>
                    </div>
                    <div class="totalscore"
                    <% if (dans) { %>
                        style="filter: invert(50%); opacity: 0.95;"
                    <% } %>>
                        <h1>Total Score</h1>
                        <h2><%= info.tscore.toLocaleString() %></h2>
                    </div>
                    <div class="maxcombo">
                        <h1>Maximum Combo</h1>
                        <h2>
                            <% if (dans) { %>
                                <%= max_combo.toLocaleString() %>
                            <% } else { %>
                                <%= info.max_combo.toLocaleString() %>
                            <% } %>
                        </h2>
                    </div>
                    <div class="watched"
                    <% if (dans) { %>
                        style="filter: invert(50%); opacity: 0.95;"
                    <% } %>>
                        <h1>Replays Watched</h1>
                        <h2><%= info.replay_views.toLocaleString() %></h2>
                    </div>
                </div>
            </div>
            <!-- best performance -->
            <div class="box bestpp">
                <h1><i class="fa-regular fa-chart-bar"></i>Best Performance</h1>
                <div class="mode-<%= modeNum %>">
                    <% let amt = 0; %>
                    <% if (bestpp.length === 0) { %>
                        <h1 class="nothing">No scores available</h1>
                    <% } else { %>
                        <% bestpp.forEach((data) => { %>
                            <div class="wrap data">
                                <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                <a
                                <% if (!dans) { %>
                                    href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                <% } %>
                                style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                    <p class="title"><%= data.title %> by <%= data.artist %></p>
                                    <p class="diff"><%= data.version %></p>
                                </a>
                                <div class="mods">
                                    <% getMods(data.mods).forEach((mod) => { %>
                                        <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png" alt="">
                                    <% }); %>
                                </div>
                                <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                <div class="pp">
                                    <p class="recorded"
                                        <% if (dans) { %>
                                            style="margin: auto";
                                        <% } %>>
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } %>
                                    </p>
                                    <% if (!dans) { %>
                                        <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt)).toLocaleString() %>pp)</p>
                                    <% } %>
                                </div>
                            </div>
                            <div class="data-mobile">
                                <div class="flex info">
                                    <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                    <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                    <a 
                                    <% if (!dans) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>>
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <% if (data.mods !== 0) { %>
                                        <div class="mods">
                                            <% getMods(data.mods).forEach((mod) => { %>
                                                <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png" alt="">
                                            <% }); %>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex results">
                                    <p class="acc"><%= data.acc.toFixed(2) %>%</p>
                                    <p class="recorded">
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } %>
                                    </p>
                                    <% if (!dans) { %>
                                        <p class="weighted">(<%= Math.round(data.pp * Math.pow(0.95, amt++)).toLocaleString() %>pp)</p>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
            </div>
            <% for (let i = 0; i * 50 < bestpp.length; i++) { %>
                <% if (i === 0) { %>
                    <% if (bestpp.length > 5) { %>
                        <button class="show-more bp to50">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } else { %>
                    <button class="show-more bp to<%= (i + 1) * 50 %>" style="display: none">
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                        show more
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                    </button>
                <% } %>
            <% } %>
            <!-- most plays -->
            <div class="box mostplays">
                <h1><i class="fa-regular fa-circle-play"></i>Most Plays</h1>
                <div class="mode-<%= modeNum %>">
                    <% if (mostplays.length <= 0) { %>
                        <h1 class="nothing">No scores available</h1>
                    <% } else { %>
                        <% mostplays.forEach((data) => { %>
                            <div class="data" 
                            <% if (dans) { %>
                                style="height: 55px;"
                            <% } %>>
                                <% if (!dans) { %>
                                    <img src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?" alt="">
                                <% } %>
                                <a
                                <% if (!dans) { %>
                                    href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                <% } %>>
                                    <p class="title"><%= data.title %> [<%= data.version%>] by <%= data.artist %></p>
                                    <p class="mapper">mapped by <span><%= data.creator %></span></p>
                                </a>
                                <i class="mode-icon mode-<%= getMode(data.mode) %>"></i>
                                <div>
                                    <i class="fa-solid fa-play play-icon"></i>
                                    <p class="value"><%= data.playtimes.toLocaleString() %></p>
                                </div>
                            </div>
                            <div class="data-mobile"
                            <% if (dans) {%>
                                style="height: 54px;"
                            <% } %>>
                                <div class="mapbg"
                                <% if (dans) {%>
                                    style="background-color: unset; height: 54px;"
                                <% } %>>
                                    <% if (!dans) { %>
                                        <img src="https://b.ppy.sh/thumb/<%= data.set_id %>l.jpg?" alt="">
                                    <% } %>
                                    <div>
                                        <i class="fa-solid fa-play play-icon"></i>
                                        <p class="value"><%= data.playtimes.toLocaleString() %></p>
                                    </div>
                                </div>
                                <a
                                <% if (!dans) { %>
                                    href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                <% } %>>
                                    <p class="title"><%= data.title %> [<%= data.version%>] by <%= data.artist %></p>
                                    <p class="mapper">mapped by <span><%= data.creator %></span></p>
                                </a>
                                <i class="mode-icon mode-<%= getMode(data.mode) %>"></i>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
            </div>
            <% for (let i = 0; i * 50 < mostplays.length; i++) { %>
                <% if (i === 0) { %>
                    <% if (mostplays.length > 5) { %>
                        <button class="show-more mp to50">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } else { %>
                    <button class="show-more mp to<%= (i + 1) * 50 %>" style="display: none">
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                        show more
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                    </button>
                <% } %>
            <% } %>
            <!-- recent plays -->
            <div class="box recentplays">
                <div class="flex">
                    <h1><i class="fa-regular fa-calendar-days"></i>Recent Plays</h1>
                    <button class="all">Show all</button>
                    <button class="passed" style="filter: invert(0%); opacity: 1;">Only passed</button>
                </div>
                <div class="mode-<%= modeNum %>">
                    <!-- Show all -->
                    <% if (recentplays.length <= 0) { %>
                        <h1 class="nothing" style="display: none;">No scores available</h1>
                    <% } else { %>
                        <% recentplays.forEach((data) => { %>
                            <div class="data" style="display: none;">
                                <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                    <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                <% } else { %>
                                    <img class="grade" src="/image/grade/F.png" alt="">
                                <% } %>
                                <a
                                <% if (!dans) { %>
                                    href="/beatmaps/<%= data.set_id %>/<%= data.id %>"
                                <% } %>
                                style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                    <p class="title"><%= data.title %> by <%= data.artist %></p>
                                    <p class="diff"><%= data.version %></p>
                                </a>
                                <div class="mods">
                                    <% getMods(data.mods).forEach((mod) => { %>
                                        <img title="<%= mod %>" class="mod" src="/image/mods/<%= mod %>.png" alt="">
                                    <% }); %>
                                </div>
                                <p class="acc">
                                    <% if (dans) { %>
                                        <%= data.sacc.toFixed(2) %>
                                    <% } else { %>
                                        <%= data.acc.toFixed(2) %>
                                    <% } %>
                                    %
                                </p>
                                <div class="pp">
                                    <p class="recorded">
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else if (data.grade !== "F") { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            -
                                        <% } %>
                                    </p>
                                    <p class="loved">
                                        <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                            (Loved)
                                        <% } %>
                                    </p>
                                </div>
                            </div>
                            <div class="data-mobile" style="display: none;">
                                <div class="flex info">
                                    <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                    <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                    <% } else { %>
                                        <img class="grade" src="/image/grade/F.png" alt="">
                                    <% } %>
                                    <a
                                    <% if (!dans) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>>
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <% if (data.mods !== 0) { %>
                                        <div class="mods">
                                            <% getMods(data.mods).forEach((mod) => { %>
                                                <img title="<%= mod %>" class="img" src="/image/mods/<%= mod %>.png" alt="">
                                            <% }); %>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex results">
                                    <p class="acc">
                                        <% if (dans) { %>
                                            <%= data.sacc.toFixed(2) %>
                                        <% } else { %>
                                            <%= data.acc.toFixed(2) %>
                                        <% } %>
                                        %
                                    </p>
                                    <p class="recorded">
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else if (data.grade !== "F") { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            -
                                        <% } %>
                                    </p>
                                    <p class="loved">
                                        <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                            (Loved)
                                        <% } %>
                                    </p>
                                </div>
                            </div>
                        <% }); %>
                    <% } %>
                    <!-- Only passed -->
                    <% if (recentplays_nof.length <= 0) { %>
                        <h1 class="nothing-passed">No scores available</h1>
                    <% } else { %>
                        <% recentplays_nof.forEach((data) => { %>
                            <div class="data-passed">
                                <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                    <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                <% } else { %>
                                    <img class="grade" src="/image/grade/F.png" alt="">
                                <% } %>
                                <a
                                <% if (!dans) { %>
                                    href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                <% } %>
                                style="width: calc(100% - 320px - <%= Math.min(35 * getMods(data.mods).length, 325) %>px);">
                                    <p class="title"><%= data.title %> by <%= data.artist %></p>
                                    <p class="diff"><%= data.version %></p>
                                </a>
                                <div class="mods">
                                    <% getMods(data.mods).forEach((mod) => { %>
                                        <img class="mod" src="/image/mods/<%= mod %>.png" alt="">
                                    <% }); %>
                                </div>
                                <p class="acc">
                                    <% if (dans) { %>
                                        <%= data.sacc.toFixed(2) %>
                                    <% } else { %>
                                        <%= data.acc.toFixed(2) %>
                                    <% } %>
                                    %
                                </p>
                                <div class="pp">
                                    <p class="recorded">
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else if (data.grade !== "F") { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            -
                                        <% } %>
                                    </p>
                                    <p class="loved">
                                        <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                            (Loved)
                                        <% } %>
                                    </p>
                                </div>
                            </div>
                            <div class="data-mobile-passed">
                                <div class="flex info">
                                    <img class="mapbg" src="https://assets.ppy.sh/beatmaps/<%= data.set_id %>/covers/cover.jpg" alt="">
                                    <% if (!dans || (data.sacc >= data.dacc && data.sscore >= data.dscore)) { %>
                                        <img class="grade" src="/image/grade/<%= data.grade %>.png" alt="">
                                    <% } else { %>
                                        <img class="grade" src="/image/grade/F.png" alt="">
                                    <% } %>
                                    <a
                                    <% if (!dans) { %>
                                        href="/beatmaps/<%= data.set_id%>/<%= data.id %>"
                                    <% } %>>
                                        <p class="title"><%= data.title %> by <%= data.artist %></p>
                                        <p class="diff"><%= data.version %></p>
                                    </a>
                                    <% if (data.mods !== 0) { %>
                                        <div class="mods">
                                            <% getMods(data.mods).forEach((mod) => { %>
                                                <img class="img" src="/image/mods/<%= mod %>.png" alt="">
                                            <% }); %>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex results">
                                    <p class="acc">
                                        <% if (dans) { %>
                                            <%= data.sacc.toFixed(2) %>
                                        <% } else { %>
                                            <%= data.acc.toFixed(2) %>
                                        <% } %>
                                        %
                                    </p>
                                    <p class="recorded">
                                        <% if (!dans) { %>
                                            <%= Math.round(data.pp).toLocaleString() %><span>pp</span>
                                        <% } else if (data.grade !== "F") { %>
                                            <%= Math.round(data.reward).toLocaleString() %><span>pp</span>
                                        <% } else { %>
                                            -
                                        <% } %>
                                    </p>
                                    <p class="loved">
                                        <% if (data.status !== 2 && data.status !== 3 && !dans) { %>
                                            (Loved)
                                        <% } %>
                                    </p>
                                </div>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
            </div>
            <% for (let i = 0; i * 50 < recentplays.length; i++) { %>
                <% if (i === 0) { %>
                    <% if (recentplays.length > 5) { %>
                        <button class="show-more rp to50" style="display: none;">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } else { %>
                    <button class="show-more rp to<%= (i + 1) * 50 %>" style="display: none">
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                        show more
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                    </button>
                <% } %>
            <% } %>
            <% for (let i = 0; i * 50 < recentplays_nof.length; i++) { %>
                <% if (i === 0) { %>
                    <% if (recentplays_nof.length > 5) { %>
                        <button class="show-more rp nof to50">
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                            show more
                            <i class="fa-solid fa-chevron-down arrow down"></i>
                        </button>
                    <% } %>
                <% } else { %>
                    <button class="show-more rp nof to<%= (i + 1) * 50 %>" style="display: none">
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                        show more
                        <i class="fa-solid fa-chevron-down arrow down"></i>
                    </button>
                <% } %>
            <% } %>
        </main>
        <%- include("footer") %>
        <script>
            let before = `<%= bbcode %>`, hold, preview = false;
            window.addEventListener("DOMContentLoaded", function() {
                if (before.length > 0) {
                    if ("<%= id %>" === "<%= locals.userid %>"&& !preview) {
                        $("main .player-banner .me .edit-button").show();
                    }
                    bbCodeToHtml();
                }
                else {
                    $("main .player-banner .me .edit-button").hide();
                }
                $("#put-bbcode").show();
            });

            function clickFollowButton() {
                updateFollowButton();
                getRelationships();
            }

            function updateFollowButton() {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", "/follow", true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function() {
                    document.getElementById("follow").innerHTML = ajax.responseText;
                }
                ajax.send("<%= id %>");
            }

            function getRelationships() {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", "/relationships", true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function() {
                    document.getElementById("relationships").innerHTML = ajax.responseText;
                }
                ajax.send("<%= id %>");
            }

            function bbCodeToHtml() {
                const element = document.getElementById("put-bbcode");
                const htmlContent = element.innerText;
                element.innerHTML = htmlContent;
            }

            function cancel() {
                let sure;
                const meEditor = document.getElementById("me-editor");
                if (meEditor.value !== before) {
                    sure = confirm("Unsaved changes will be lost. Are you sure?");
                }
                else {
                    sure = true;
                }
                if (sure) {
                    meEditor.value = before;
                    preview = false;
                    prevMe(document.getElementById("put-bbcode"));
                    $("main .player-banner .me .edit-button").show();
                    $("main .player-banner .me .contents form .editor .edit .preview").show();
                    $("main .player-banner .me .contents form .editor .edit .back-to-edit").hide();
                    $("main .player-banner .me .contents .bbcode-profile").show();
                    $("main .player-banner .me .contents form textarea").show();
                    $("main .player-banner .me .contents form .editor .bb-button").show();
                    $("main .player-banner .me .contents form").hide();
                }
            }

            function showPreview(content) {
                if (document.getElementById("me-editor").value.length > 0) {
                    preview = true;
                    ajaxUpdate("/preview", document.getElementById("put-bbcode"));
                    $("main .player-banner .me .contents form .editor .edit .preview").hide();
                    $("main .player-banner .me .contents form .editor .edit .back-to-edit").show();
                    $("main .player-banner .me .contents .bbcode-profile").show();
                    $("main .player-banner .me .contents form textarea").hide();
                    $("main .player-banner .me .contents form .editor .bb-button").hide();
                }
            }

            function backToEditor() {
                preview = false;
                $("main .player-banner .me .contents form .editor .edit .preview").show();
                $("main .player-banner .me .contents form .editor .edit .back-to-edit").hide();
                $("main .player-banner .me .contents .bbcode-profile").hide();
                $("main .player-banner .me .contents form textarea").show();
                $("main .player-banner .me .contents form .editor .bb-button").show();
            }

            function save() {
                preview = false;
                before = document.getElementById("me-editor").value;
                ajaxUpdate("/me", document.getElementById("put-bbcode"));
                $("main .player-banner .me .edit-button").show();
                $("main .player-banner .me .contents form .editor .edit .preview").show();
                $("main .player-banner .me .contents form .editor .edit .back-to-edit").hide();
                $("main .player-banner .me .contents .bbcode-profile").show();
                $("main .player-banner .me .contents form textarea").show();
                $("main .player-banner .me .contents form .editor .bb-button").show();
                $("main .player-banner .me .contents form").hide();
            }

            function ajaxUpdate (link, element) {
                const ajax = new XMLHttpRequest();
                ajax.open("POST", link, true);
                ajax.setRequestHeader("Content-Type", "text/plain");
                ajax.onload = function () {
                    element.innerHTML = ajax.responseText;
                    if (before.length > 0 || preview) {
                        if ("<%= id %>" === "<%= locals.userid %>" && !preview) {
                            $("main .player-banner .me .edit-button").show();
                        }
                        bbCodeToHtml();
                    }
                    else {
                        $("main .player-banner .me .edit-button").hide();
                    }
                    $("main .player-banner .me .contents .edit-me").click(function() {
                        $("main .player-banner .me .contents .bbcode-profile").hide();
                        $("main .player-banner .me .contents form").show();
                    });
                }
                ajax.send(document.getElementById("me-editor").value);
            }

            function prevMe(element) {
                const ajax = new XMLHttpRequest();
                ajax.open("GET", "/me", true);
                ajax.onload = function () {
                    element.innerHTML = ajax.responseText;
                    if (before.length > 0 || preview) {
                        if ("<%= id %>" === "<%= locals.userid %>" && !preview) {
                            $("main .player-banner .me .edit-button").show();
                        }
                        bbCodeToHtml();
                    }
                    else {
                        $("main .player-banner .me .edit-button").hide();
                    }
                    $("main .player-banner .me .contents .edit-me").click(function() {
                        $("main .player-banner .me .contents .bbcode-profile").hide();
                        $("main .player-banner .me .contents form").show();
                    });
                }
                ajax.send(null);
            }
        </script>
    </body>
</html>
